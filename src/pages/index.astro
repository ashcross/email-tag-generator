---
import Layout from '../layouts/Layout.astro';

// Welcome to Astro! Wondering what to do next? Check out the Astro documentation at https://docs.astro.build
// Don't want to use any of this? Delete everything in this file, the `assets`, `components`, and `layouts` directories, and start fresh.
---

<Layout Title="Create a Tagged Email">
	<main class="min-h-screen bg-base-200 py-8 px-4 flex justify-center items-center">
		<div class="max-w-xl mx-auto my-auto">
			<div class="card bg-base-100 shadow-xl">
				<div class="card-body">
					<h1 class="card-title text-2xl font-bold text-center justify-center">Email Tag Generator</h1>
					<p class="text-center text-base-content/80 mt-2">
						Generate unique email tags using the + symbol for testing and filtering purposes.
					</p>

					<div class="mt-6" x-data="{
						email: '',
						taggedEmail: '',
						showCopySuccess: false,
						isError: false,
						errorMessage: '',
						
						generateTag() {
							if (!this.email.includes('@')) {
								this.isError = true;
								this.errorMessage = 'Please enter a valid email address';
								return;
							}
							
							this.isError = false;
							const [username, domain] = this.email.split('@');
							const tag = Math.random().toString(36).substring(2, 8);
							this.taggedEmail = `${username}+${tag}@${domain}`;
						},
						
						async copyToClipboard() {
							try {
								await navigator.clipboard.writeText(this.taggedEmail);
								this.showCopySuccess = true;
								setTimeout(() => this.showCopySuccess = false, 2000);
							} catch (err) {
								this.isError = true;
								this.errorMessage = 'Failed to copy. Please try manually selecting the email.';
							}
						}
					}">
						<!-- Email Input -->
						<div class="form-control">
							<label class="label">
								<span class="label-text">Your Email Address</span>
							</label>
							<input 
								type="email" 
								placeholder="example@domain.com" 
								class="input input-bordered w-full" 
								x-model="email"
								@input="isError = false"
							/>
						</div>

						<!-- Error Message -->
						<div 
							x-show="isError" 
							x-cloak 
							class="alert alert-error mt-4"
							role="alert"
						>
							<span x-text="errorMessage"></span>
						</div>

						<!-- Generate Button -->
						<button 
							class="btn btn-primary w-full mt-4" 
							@click="generateTag()"
						>
							Generate Tagged Email
						</button>

						<!-- Output Section -->
						<div 
							x-show="taggedEmail" 
							x-cloak 
							class="mt-6"
						>
							<div class="divider">Generated Email</div>
							<div class="bg-base-200 p-4 rounded-lg break-all">
								<p class="font-mono" x-text="taggedEmail"></p>
							</div>
							
							<button 
								class="btn btn-secondary w-full mt-4" 
								@click="copyToClipboard()"
							>
								Copy to Clipboard
							</button>

							<!-- Copy Success Message -->
							<div 
								x-show="showCopySuccess" 
								x-cloak 
								class="alert alert-success mt-4"
								role="alert"
							>
								<span>Email copied to clipboard!</span>
							</div>
						</div>
					</div>

					<div class="divider mt-8"></div>
					
					<footer class="text-sm text-base-content/70">
						<p>Email tags (using the + symbol) allow you to create unlimited variations of your email address. 
						Most email providers will deliver messages sent to tagged addresses to your main inbox, making it perfect for testing and filtering purposes.</p>
					</footer>
				</div>
			</div>
		</div>
	</main>
</Layout>

<style>
	[x-cloak] { display: none !important; }
</style>
